### SSA(奇异谱分析)简介

奇异谱分析(Singular Spectrum Analysis, SSA)是一种用于分析时间序列数据的非参数方法,它能够将时间序列分解为多个独立的成分,有助于揭示时间序列中的潜在结构、趋势、周期性以及噪声等信息.

#### 1. 原理

SSA 的核心原理基于对时间序列构建 Hankel 矩阵,并对该矩阵进行奇异值分解(Singular Value Decomposition, SVD).

- **构建 Hankel 矩阵**: 
  给定一个时间序列 \( x = \{x_1, x_2, \cdots, x_N\} \) (对应代码中的 `time_series`), 选择一个窗口大小 \( L \) (对应代码中的 `window_size`, 满足 \( 1 < L < N \)). 通过 Hankel 矩阵的构造方式, 构建一个 \( K \times L \) 的 Hankel 矩阵 \( X \) (对应代码中的 `X`, 其中 \( K = N - L + 1 \)). 其元素构造规则如下: 
  \[
  X = \begin{pmatrix}
  x_1 & x_2 & \cdots & x_L \\
  x_2 & x_3 & \cdots & x_{L + 1} \\
  \vdots & \vdots & \ddots & \vdots \\
  x_K & x_{K + 1} & \cdots & x_N
  \end{pmatrix}
  \]
  例如, 对于时间序列 \( x = \{1, 2, 3, 4, 5\} \), 若选择窗口大小 \( L = 3 \), 则构建的 Hankel 矩阵为: 
  \[
  X = \begin{pmatrix}
  1 & 2 & 3 \\
  2 & 3 & 4 \\
  3 & 4 & 5
  \end{pmatrix}
  \]

- **奇异值分解(SVD)**: 
  对构建好的 Hankel 矩阵 \( X \) 进行奇异值分解, 即 \( X = U \Sigma V^T \) (对应代码中的 `U, s, Vt`), 其中: 
  - \( U \) 是一个 \( K \times K \) 的正交矩阵 (对应代码中的 `U`), 其列向量称为左奇异向量；
  - \( \Sigma \) 是一个 \( K \times L \) 的对角矩阵 (对应代码中的 `s`, 实际上是1D数组), 对角线上的元素为奇异值 \( \sigma_i \) (对应代码中的 `s`), 通常按从大到小排序, 非对角元素为 \( 0 \)；
  - \( V^T \) 是一个 \( L \times L \) 的正交矩阵 (对应代码中的 `Vt`), 其转置 \( V^T \) 的行向量称为右奇异向量.

- **分解与重构**: 
  经过 SVD 后, 奇异值的大小反映了对应成分在原时间序列中的重要程度. 通过选择合适的奇异值对应的成分 (通常根据累积贡献率等准则, 对应代码中的 `select_components` 函数), 可以将时间序列分解为不同的子序列, 这些子序列分别对应着原时间序列中的不同结构信息, 比如趋势、周期等. 然后可以利用选定的成分进行重构, 得到重构后的时间序列 (对应代码中的 `reconstruct` 方法), 以此来分析原时间序列或者进行后续的预测等操作.

#### 2. 公式

- **奇异值分解公式**: 
  \[
  X_{K \times L} = U_{K \times K} \Sigma_{K \times L} V_{L \times L}^T
  \]
  其中, 矩阵元素之间满足以下关系: 
  \[
  X_{ij} = \sum_{k = 1}^{\min(K, L)} u_{ik} \sigma_{k} v_{jk}^T
  \]
  这里 \( u_{ik} \) 是矩阵 \( U \) 的元素 (对应代码中的 `U`), \( \sigma_{k} \) 是对角矩阵 \( \Sigma \) 的对角元素 (奇异值, 对应代码中的 `s`), \( v_{jk} \) 是矩阵 \( V \) 的元素 (对应代码中的 `Vt`).

- **重构公式**: 
  若选择了一组奇异值对应的成分索引集合 \( \{i_1, i_2, \cdots, i_m\} \) (对应代码中的 `components` 列表) 来重构时间序列, 重构的 Hankel 矩阵 \( X_{reconstructed} \) 可以表示为: 
  \[
  X_{reconstructed} = \sum_{r = 1}^{m} \sigma_{i_r} u_{:, i_r} v_{i_r, :}^T
  \]
  其中, \( u_{:, i_r} \) 表示矩阵 \( U \) 的第 \( i_r \) 列向量 (对应代码中的 `U[:, comp]`), \( v_{i_r, :}^T \) 表示矩阵 \( V^T \) 的第 \( i_r \) 行向量 (对应代码中的 `Vt[comp, :]`). 然后通过一定的方式从重构的 Hankel 矩阵还原得到重构后的时间序列 (具体还原方式根据实际构造过程逆推, 代码示例中有体现).

#### 3. 简单例子

假设有如下简单的时间序列 \( x = \{1, 2, 3, 4, 5, 6\} \), 我们选择窗口大小 \( L = 4 \) 进行 SSA 分析.

1. **构建 Hankel 矩阵**: 
   \[
   X = \begin{pmatrix}
   1 & 2 & 3 & 4 \\
   2 & 3 & 4 & 5 \\
   3 & 4 & 5 & 6
   \end{pmatrix}
   \]

2. **奇异值分解(SVD)**: 
   通过计算 (可使用相应的数学库, 如代码中的 `np.linalg.svd`) 得到 \( U \), \( \Sigma \), \( V^T \) 矩阵. 假设得到的奇异值 \( \sigma_1, \sigma_2, \sigma_3, \sigma_4 \) (按从大到小顺序) 分别为对应的数值 (这里仅为示例假设值), 比如 \( \sigma_1 = 10 \), \( \sigma_2 = 5 \), \( \sigma_3 = 1 \), \( \sigma_4 = 0.1 \).

3. **选择成分与重构**: 
   根据累积贡献率等规则 (如代码中设置一个阈值来选择成分), 假如选择前两个成分 (对应奇异值 \( \sigma_1 \) 和 \( \sigma_2 \)) 来重构. 按照重构公式计算重构的 Hankel 矩阵 \( X_{reconstructed} \), 再从这个矩阵还原得到重构后的时间序列, 通过这个重构后的时间序列就可以分析原时间序列中的主要结构等信息.

总之, SSA 通过上述的步骤将复杂的时间序列进行分解与重构, 帮助我们更好地理解时间序列的内在特性, 在时间序列分析、预测等领域有着广泛的应用.

在给定的代码中, `SSA` 类就是按照上述原理来实现对输入时间序列的分解与重构操作, 后续基于重构后的序列进一步进行特征工程、模型训练等处理, 以实现对时间序列数据的分析和预测任务.